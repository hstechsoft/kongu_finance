<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="form-container">
        <h3 class="text-center mb-4">Employee Registration Form</h3>

        <form class="p-4 border rounded-4 shadow-sm bg-light needs-validation" id="employeeForm" novalidate onsubmit="return false">
            <div class="row g-3">
                <input type="hidden" name="action" id="action" value="create">
                <input type="hidden" name="employee_id" id="employee_id" value="">

                <!-- Employee Name -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="text" class="form-control" name="employee_name" id="employee_name"
                            placeholder="Enter employee name">
                        <label for="employee_name">Employee Name</label>
                    </div>
                </div>

                <!-- Phone Number -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="tel" class="form-control" name="phone" id="phone" placeholder="Enter phone number">
                        <label for="phone">Phone Number</label>
                    </div>
                </div>

                <!-- Alternative Phone -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="tel" class="form-control" name="alt_phone" id="alt_phone"
                            placeholder="Enter alternative phone number">
                        <label for="alt_phone">Alternative Phone Number</label>
                    </div>
                </div>

                <!-- Aadhar Number -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="text" class="form-control" name="aadhar" id="aadhar"
                            placeholder="Enter Aadhar number">
                        <label for="aadhar">Aadhar Number</label>
                    </div>
                </div>

                <!-- Voter ID -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="text" class="form-control" name="voter_id" id="voter_id"
                            placeholder="Enter voter ID">
                        <label for="voter_id">Voter ID</label>
                    </div>
                </div>

                <!-- Employee Login -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="text" class="form-control" name="employee_login" id="employee_login"
                            placeholder="Enter Employee Login">
                        <label for="employee_login">Employee Login</label>
                    </div>
                </div>

                <!-- Employee Password -->
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="password" class="form-control" name="employee_password" id="employee_password"
                            placeholder="Enter Employee Password">
                        <i class="fa-solid fa-eye eye-icon" id="togglePassword"></i>
                        <label for="employee_password">Employee Password</label>
                    </div>
                </div>

                <!-- Address -->
                <div class="col-12">
                    <div class="form-floating">
                        <textarea class="form-control" name="address" id="address" placeholder="Enter address"
                            style="height: 100px"></textarea>
                        <label for="address">Address</label>
                    </div>
                </div>

                <!-- Location (Google Maps Picker) -->
                <div class="col-md-12">
                    <label class="form-label">Location</label>
                    <div class="input-group">
                        <input type="text" class="form-control" name="location_url" id="location_url"
                            placeholder="Select location from map">
                        <button class="btn btn-outline-primary" type="button" onclick="openMap()">üìç Pick
                            Location</button>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary mt-3">Submit</button>
        </form>
      
    </div>

    <!-- Employee Table -->
    <div class="container mt-5">
        <h4 class="mb-3">Employee Data</h4>
        <table class="table table-bordered table-striped text-center" >
            <thead class="table-dark">
                <tr>
                    <th>S/No</th>
                    <th>Employee Name</th>
                    <th>Phone Number</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="employeeTable">
                <!-- Rows will be added dynamically -->
               
            </tbody>
        </table>
    </div>

    <script>
        function loadEmployees() {
            $.get("php/employee.php", function (res) {
                if (res.status === "success") {
                    let rows = "";
                    res.data.forEach((emp, i) => {
                        rows += `
            <tr data-id="${emp.id}" data-name="${emp.employee_name}" data-phone="${emp.phone}" data-alt_phone="${emp.alt_phone}" data-aadhar="${emp.aadhar}" 
        data-voter_id="${emp.voter_id}" data-employee_login="${emp.employee_login}" data-password="${emp.employee_password}" data-address="${emp.address}" data-location_url="${emp.location_url}">
                <td>${i + 1}</td>
                <td>${emp.employee_name}</td>
                <td>${emp.phone ?? '-'}</td>
                <td>
                <button class="btn btn-sm btn-warning edit-btn"><i class="fa fa-edit"></i></button>
                <button class="btn btn-sm btn-danger delete-btn"><i class="fa fa-trash"></i></button>
                </td>
            </tr>`;
                    });
                    $("#employeeTable tbody").html(rows);
                }
            }, "json");
        }


        $("#employeeForm").on("submit", function (e) {
            e.preventDefault();
            $.post("php/employee.php", $(this).serialize(), function (res) {
                if (res.status === "success") {
                    Swal.fire("Success", res.message, "success");
                    $("#employeeForm")[0].reset();
                    loadEmployees();
                } else {
                    Swal.fire("Error", res.message, "error");
                }
            }, "json");
        });


        // DELETE EMPLOYEE
        $(document).on("click", ".delete-btn", function () {
            let row = $(this).closest("tr");
            let empName = row.find("td:eq(1)").text();
            let empId = row.data("id");


            Swal.fire({
                title: "Are you sure?",
                text: `Do you want to delete ${empName}?`,
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Yes, delete it!"
            }).then((result) => {
                if (result.isConfirmed) {
                    $.post("php/employee.php", { action: "delete", id: empId }, function (res) {
                        if (res.status === "success") {
                            Swal.fire("Deleted!", res.message, "success").then(() => {
                                loadEmployees();
                            });
                        } else {
                            Swal.fire("Error!", res.message, "error");
                        }
                    }, "json");
                }
            });
        });



        $(document).on("click", ".edit-btn", function () {
            let row = $(this).closest("tr");
            let editingId = row.data("id");

            $("#employee_id").val(editingId);
            $("#action").val("update"); // mark it as update

            $("#employee_name").val(row.data("name"));
            $("#phone").val(row.data("phone"));
            $("#alt_phone").val(row.data("alt_phone"));
            $("#aadhar").val(row.data("aadhar"));
            $("#voter_id").val(row.data("voter_id"));
            $("#employee_login").val(row.data("employee_login"));
            $("#employee_password").val(""); // password optional
            $("#address").val(row.data("address"));
            $("#location_url").val(row.data("location_url"));

            Swal.fire("Edit Mode", "Update details and click Submit.", "info");
        });




        function openMap() {
            const url = prompt("Paste Google Maps URL after selecting a location:");
            if (url) {
                document.getElementById("location_url").value = url;
            }
        }

        $("#togglePassword").on("click", function () {
            let passwordField = $("#employee_password");
            let type = passwordField.attr("type") === "password" ? "text" : "password";
            passwordField.attr("type", type);

            $(this).toggleClass("fa-eye fa-eye-slash");
        });

        $(document).ready(function () {
            loadEmployees();
        });

        $("#employeeForm").on("submit", function (e) {
            e.preventDefault();
            $.post("php/employee.php", $(this).serialize(), function (res) {
                if (res.status === "success") {
                    Swal.fire("Success", res.message, "success");
                    $("#employeeForm")[0].reset();
                    $("#action").val("create"); // reset to create
                    loadEmployees();
                } else {
                    Swal.fire("Error", res.message, "error");
                }
            }, "json");
        });

    </script>

    <style>
        .form-container {
            max-width: 800px;
            margin: 30px auto;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .eye-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #6c757d;
        }
    </style>
    <script src="js/employeeCreation.js" type="module"></script>
    <script src="js/get_all_id.js" type="module"></script>
</body>

</html>